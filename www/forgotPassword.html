<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <title>Forgot Password</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta name="color-scheme" content="light">

    <!-- Use the same externalized styles as createAccount.html -->
    <link rel="stylesheet" href="css/newStyle.css" />

    <!-- Cordova & libs (unchanged) -->
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-1.8.9.ui.js"></script>
  </head>

  <!-- Match createAccount: apply gradient background from newStyle.css -->
  <body class="gradient">
    <main class="page-wrap container">
      <!-- Match createAccount’s card + field + control + input classes -->
      <section class="card" role="form" aria-labelledby="billingTitle">

        <!-- NEW: back button moved inside the card -->
        <div class="card-top">
          <a href="login.html" class="back-btn" aria-label="Back to Sign In">
            <span>Back to Sign In</span>
          </a>
        </div>

        <h2 id="billingTitle" style="margin:6px 0 6px; font-size:18px;">Reset your password</h2>
        <p class="page-lead">
          Enter the email address of your Glass Card account to receive a reset link.
        </p>

        <form class="account" id="ccform" novalidate>
          <div class="field">
            <label for="deviceID">Email</label>
            <div class="control">
              <input id="deviceID" class="input" data-clear-btn="true" type="text" inputmode="email"
                     autocomplete="email" placeholder="you@example.com">
            </div>
          </div>

          <div style="margin-top:14px">
            <!-- Keep the anchor id='login' for your existing handler -->
            <a href="#" id="login" class="link" style="display:block;text-decoration:none;">
              <button type="button" class="btn login">Reset Password</button>
            </a>
          </div>
        </form>
      </section>
    </main>

    <!-- Styled jQuery UI dialog host (same structure/classes as createAccount) -->
    <div id="messagePopup" title=""><label id="messageText"></label></div>

    <script type="text/javascript">
      $(document).ready(function() {

        // === Styled dialog helper (mirrors createAccount.html) ===
        function displayMessage(title, message, buttonText, url) {
          var iconSVG = '<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 7.75a.75.75 0 0 1 .75.75v6a.75.75 0 0 1-1.5 0V8.5a.75.75 0 0 1 .75-.75Zm0 9a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z" fill="#fff"/><path d="M12 2.5c-5.247 0-9.5 4.253-9.5 9.5s4.253 9.5 9.5 9.5 9.5-4.253 9.5-9.5-4.253-9.5-9.5-9.5Z" stroke="rgba(255,255,255,.7)" stroke-opacity=".35"/></svg>';
          var html =
            '<div class="gc-dialog__body">' +
              '<div class="gc-dialog__icon">'+ iconSVG +'</div>' +
              '<div>' +
                (title ? '<div class="gc-dialog__title">'+ title +'</div>' : '') +
                '<div class="gc-dialog__text">'+ message +'</div>' +
              '</div>' +
            '</div>';

          $('#messagePopup').html(html).dialog({
            modal: true,
            resizable: false,
            draggable: false,
            closeOnEscape: true,
            width: Math.min($(window).width() - 32, 560),
            dialogClass: 'gc-dialog',
            open: function() {
              $(this).siblings('.ui-dialog-titlebar').hide();
            },
            buttons:[{
              text: buttonText || "OK",
              click:function(){
                $(this).dialog("close");
                if ((url != undefined) && (url.length > 0)) {
                  window.location.href = url;
                }
              }
            }]
          });
        }

        // (UNCHANGED) Cordova device hook
        document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady() {}

        // (UNCHANGED) Reset flow — kept identical, just calling the new displayMessage
        $(document).on("click","a[id='login']", function (event) {
          event.preventDefault();

          $.ajax({
            url : "https://glasscard.org/dataaccessprod4/passwordEmailer.ashx",
            type: "POST",
            data: "DeviceID=" + ($('#deviceID').val()||''),
            dataType: "text",
            crossdomain: true,
            success: function(data, textStatus, jqXHR) {
              if (data == "InvalidDeviceID") {
                displayMessage("Unknown Account", "Sorry, we couldn't find that e-mail account. Please try again.", "OK");
              } else { // Success
                displayMessage("Email Sent", "A link to reset your password has been sent to the specified e-mail address.", "Continue", "login.html");
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {
              console.log(errorThrown);
              console.log(textStatus);
              console.log(jqXHR);
              displayMessage("System Error", "An unrecoverable error was encountered.", "Close");
            }
          });
        });

        // Keep improved back navigation logic intact (now attached to the in-card back button)
        (function(){
          var el = document.querySelector('.back-btn');
          if(!el) return;

          el.addEventListener('click', function(e){
            var canGoBack = (window.history.length > 1);
            var ref = document.referrer || "";
            var cameFromLogin = /\/login\.html(\?|#|$)/i.test(ref);

            if (canGoBack && !cameFromLogin) {
              e.preventDefault();
              history.back();
              return;
            }
            // Otherwise fall through to href="login.html"
          }, {passive:true});
        })();

      });
    </script>
  </body>
</html>
